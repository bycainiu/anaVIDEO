# æ•°æ®æŒä¹…åŒ–æ¶æ„è®¾è®¡ / Data Persistence Architecture

## ğŸ“‹ ç›®å½• / Table of Contents
1. [å½“å‰æ¶æ„åˆ†æ](#current-architecture)
2. [é—®é¢˜ä¸æŒ‘æˆ˜](#problems-and-challenges)
3. [æ¨èæ¶æ„æ–¹æ¡ˆ](#recommended-architecture)
4. [å®æ–½è·¯çº¿å›¾](#implementation-roadmap)
5. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#performance-optimization)
6. [æœªæ¥æ‰©å±•æ€§](#future-scalability)

---

## ğŸ” å½“å‰æ¶æ„åˆ†æ / Current Architecture Analysis

### å½“å‰æ•°æ®å­˜å‚¨æ–¹å¼

#### 1. **IndexedDB (Browser)**
- **å­˜å‚¨å†…å®¹**:
  - è§†é¢‘æ–‡ä»¶ (Blob)
  - è§†é¢‘åˆ†æç»“æœ (JSON)
  - å¸§å›¾åƒæ•°æ® (Base64)

- **ä¼˜ç‚¹**:
  - âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
  - âœ… å¼‚æ­¥æ“ä½œï¼Œä¸é˜»å¡ UI
  - âœ… å¯å­˜å‚¨å¤§é‡æ•°æ® (ç†è®ºä¸Šæ— é™åˆ¶)

- **ç¼ºç‚¹**:
  - âŒ æ•°æ®æ˜“ä¸¢å¤±ï¼ˆæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼‰
  - âŒ æ— æ³•è·¨è®¾å¤‡åŒæ­¥
  - âŒ æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶
  - âŒ æŸ¥è¯¢æ€§èƒ½æœ‰é™
  - âŒ æ— æ³•è¿›è¡Œå¤æ‚çš„è¯­ä¹‰æœç´¢

#### 2. **æ•°æ®ç»“æ„**
```typescript
interface AnalyzedVideo {
  id: string;
  name: string;
  file?: File;
  frames: string[];  // Base64 encoded images
  analysis: {
    overallSummary: { en: string; cn: string };
    frameAnalyses: Array<{
      timestamp: number;
      personDescription: { en: string; cn: string };
      clothingDescription: { en: string; cn: string };
      actionDescription: { en: string; cn: string };
      inferredBehavior: { en: string; cn: string };
      keywords: { en: string[]; cn: string[] };
      expandedKeywords: { en: string[]; cn: string[] };
    }>;
  };
}
```

---

## âš ï¸ é—®é¢˜ä¸æŒ‘æˆ˜ / Problems and Challenges

### 1. **æ•°æ®å¯é æ€§é—®é¢˜**
- ç”¨æˆ·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ â†’ æ‰€æœ‰æ•°æ®ä¸¢å¤±
- æµè§ˆå™¨å´©æºƒ â†’ å¯èƒ½å¯¼è‡´æ•°æ®æŸå
- æ— å¤‡ä»½æœºåˆ¶

### 2. **æ€§èƒ½é—®é¢˜**
- Base64 ç¼–ç çš„å›¾åƒå ç”¨å¤§é‡ç©ºé—´
- IndexedDB æŸ¥è¯¢é€Ÿåº¦æ…¢ï¼ˆå°¤å…¶æ˜¯å¤§é‡æ•°æ®æ—¶ï¼‰
- æ— æ³•è¿›è¡Œå…¨æ–‡æœç´¢æˆ–è¯­ä¹‰æœç´¢

### 3. **æ‰©å±•æ€§é—®é¢˜**
- æ— æ³•æ”¯æŒå¤šç”¨æˆ·åä½œ
- æ— æ³•è·¨è®¾å¤‡è®¿é—®
- æ— æ³•é›†æˆé«˜æ€§èƒ½æœç´¢å¼•æ“

### 4. **æ•°æ®ä¸€è‡´æ€§é—®é¢˜**
- è§†é¢‘æ–‡ä»¶ä¸åˆ†æç»“æœå¯èƒ½ä¸åŒæ­¥
- æ²¡æœ‰äº‹åŠ¡æ”¯æŒ
- æ•°æ®è¿ç§»å›°éš¾

---

## ğŸ—ï¸ æ¨èæ¶æ„æ–¹æ¡ˆ / Recommended Architecture

### æ–¹æ¡ˆ A: æ··åˆæ¶æ„ï¼ˆçŸ­æœŸ - 1-3 ä¸ªæœˆï¼‰

**é€‚ç”¨åœºæ™¯**: å¿«é€Ÿæ”¹è¿›ç°æœ‰ç³»ç»Ÿï¼Œä¿æŒå‰ç«¯ç‹¬ç«‹æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (React + Vite)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  IndexedDB   â”‚  â”‚ localStorage â”‚  â”‚  File API    â”‚      â”‚
â”‚  â”‚  (ä¸´æ—¶ç¼“å­˜)   â”‚  â”‚  (ç”¨æˆ·è®¾ç½®)   â”‚  â”‚  (è§†é¢‘æ–‡ä»¶)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â†“                  â†“                  â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚         Data Export/Import Layer                 â”‚       â”‚
â”‚  â”‚  (JSON Export, Backup to Cloud Storage)         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (Optional)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloud Storage (å¯é€‰)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Google Drive â”‚  â”‚   Dropbox    â”‚  â”‚     AWS S3   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ”¹è¿›
1. **è‡ªåŠ¨å¤‡ä»½æœºåˆ¶**
   - å®šæœŸå¯¼å‡ºæ•°æ®åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
   - æ”¯æŒå¯¼å‡ºä¸º JSON æ ¼å¼
   - å¯é€‰ï¼šå¤‡ä»½åˆ°äº‘å­˜å‚¨ (Google Drive API)

2. **æ•°æ®ç‰ˆæœ¬æ§åˆ¶**
   - æ¯æ¬¡ä¿®æ”¹è®°å½•ç‰ˆæœ¬å·
   - æ”¯æŒå›æ»šåˆ°å†å²ç‰ˆæœ¬

3. **æ•°æ®éªŒè¯å±‚**
   - å†™å…¥å‰éªŒè¯æ•°æ®å®Œæ•´æ€§
   - è‡ªåŠ¨ä¿®å¤æŸåçš„æ•°æ®

---

### æ–¹æ¡ˆ B: å…¨æ ˆæ¶æ„ï¼ˆä¸­æœŸ - 3-6 ä¸ªæœˆï¼‰

**é€‚ç”¨åœºæ™¯**: éœ€è¦å¤šç”¨æˆ·ã€è·¨è®¾å¤‡ã€é«˜æ€§èƒ½æœç´¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Frontend (React + Vite)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚         Local Cache (IndexedDB + Service Worker) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ REST API / GraphQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Backend API Server                       â”‚
â”‚                  (Node.js + Express / FastAPI)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Business   â”‚  â”‚  Auth Layer  â”‚  â”‚  API Routes  â”‚      â”‚
â”‚  â”‚    Logic     â”‚  â”‚   (JWT)      â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚  Meilisearch â”‚      â”‚
â”‚  â”‚ (ä¸»æ•°æ®åº“)    â”‚  â”‚  (ç¼“å­˜å±‚)     â”‚  â”‚  (å…¨æ–‡æœç´¢)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚   AWS S3 /   â”‚  â”‚  Qdrant /    â”‚                        â”‚
â”‚  â”‚  MinIO       â”‚  â”‚  Weaviate    â”‚                        â”‚
â”‚  â”‚ (è§†é¢‘å­˜å‚¨)    â”‚  â”‚ (å‘é‡æœç´¢)    â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ ˆæ¨è

##### 1. **å…³ç³»å‹æ•°æ®åº“: PostgreSQL**
**ç”¨é€”**: å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼ˆç”¨æˆ·ä¿¡æ¯ã€è§†é¢‘å…ƒæ•°æ®ã€åˆ†æç»“æœï¼‰

```sql
-- è§†é¢‘è¡¨
CREATE TABLE videos (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    name VARCHAR(255) NOT NULL,
    file_path TEXT NOT NULL,
    duration FLOAT,
    size BIGINT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- å¸§åˆ†æè¡¨
CREATE TABLE frame_analyses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    video_id UUID REFERENCES videos(id) ON DELETE CASCADE,
    timestamp FLOAT NOT NULL,
    person_description JSONB,
    clothing_description JSONB,
    action_description JSONB,
    inferred_behavior JSONB,
    keywords JSONB,
    expanded_keywords JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_video_user ON videos(user_id);
CREATE INDEX idx_frame_video ON frame_analyses(video_id);
CREATE INDEX idx_frame_timestamp ON frame_analyses(timestamp);
CREATE INDEX idx_keywords ON frame_analyses USING GIN (keywords);
```

##### 2. **å¯¹è±¡å­˜å‚¨: MinIO / AWS S3**
**ç”¨é€”**: å­˜å‚¨è§†é¢‘æ–‡ä»¶å’Œç¼©ç•¥å›¾

- åˆ†ç¦»å­˜å‚¨å±‚ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›
- æ”¯æŒ CDN åŠ é€Ÿ
- å¯æ‰©å±•æ€§å¼º

##### 3. **å…¨æ–‡æœç´¢å¼•æ“: Meilisearch**
**ç”¨é€”**: é«˜æ€§èƒ½çš„å…³é”®è¯å’Œè¯­ä¹‰æœç´¢

```javascript
// ç´¢å¼•ç»“æ„
{
  "id": "video_frame_uuid",
  "video_id": "video_uuid",
  "timestamp": 120.5,
  "keywords": ["woman", "yoga", "tattoo"],
  "expanded_keywords": ["female", "exercise", "body art"],
  "descriptions": {
    "person": "Female with tattoos",
    "action": "Performing yoga pose",
    "clothing": "Athletic wear"
  },
  "embeddings": [0.1, 0.2, ...]  // å‘é‡åµŒå…¥ï¼ˆç”¨äºè¯­ä¹‰æœç´¢ï¼‰
}
```

**ä¼˜åŠ¿**:
- ğŸš€ äºšç§’çº§æœç´¢é€Ÿåº¦
- ğŸ¯ æ¨¡ç³ŠåŒ¹é…å’Œæ‹¼å†™çº é”™
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ
- ğŸ“Š ç›¸å…³æ€§æ’åº

##### 4. **å‘é‡æ•°æ®åº“: Qdrant / Weaviate**
**ç”¨é€”**: è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢

```javascript
// å°†æè¿°è½¬æ¢ä¸ºå‘é‡åµŒå…¥
const embedding = await openai.embeddings.create({
  model: "text-embedding-3-small",
  input: "Woman doing yoga with tattoos"
});

// å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“
await qdrant.upsert({
  collection: "video_frames",
  points: [{
    id: frameId,
    vector: embedding.data[0].embedding,
    payload: {
      video_id: videoId,
      timestamp: 120.5,
      description: "..."
    }
  }]
});

// è¯­ä¹‰æœç´¢
const results = await qdrant.search({
  collection: "video_frames",
  vector: queryEmbedding,
  limit: 10
});
```

##### 5. **ç¼“å­˜å±‚: Redis**
**ç”¨é€”**: ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢

```javascript
// ç¼“å­˜è§†é¢‘åˆ†æç»“æœ
await redis.setex(
  `video:${videoId}:analysis`,
  3600,  // 1 hour TTL
  JSON.stringify(analysisData)
);

// ç¼“å­˜æœç´¢ç»“æœ
await redis.setex(
  `search:${searchQuery}`,
  1800,  // 30 minutes
  JSON.stringify(searchResults)
);
```

---

### æ–¹æ¡ˆ C: ä¼ä¸šçº§æ¶æ„ï¼ˆé•¿æœŸ - 6-12 ä¸ªæœˆï¼‰

**é€‚ç”¨åœºæ™¯**: å¤§è§„æ¨¡æ•°æ®ã€å¤šç§Ÿæˆ·ã€é«˜å¹¶å‘

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Load Balancer  â”‚
                         â”‚    (Nginx)      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway 1  â”‚   â”‚   API Gateway 2      â”‚   â”‚  API Gateway N  â”‚
â”‚  (GraphQL)      â”‚   â”‚   (GraphQL)          â”‚   â”‚  (GraphQL)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Microservice 1  â”‚   â”‚  Microservice 2      â”‚   â”‚ Microservice 3  â”‚
â”‚ (Video Upload)  â”‚   â”‚  (AI Analysis)       â”‚   â”‚ (Search/Query)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                             â”‚                             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Postgresâ”‚  â”‚ Redis  â”‚  â”‚ Elasticsearchâ”‚  â”‚ S3/MinIOâ”‚  â”‚   Qdrant   â”‚
â”‚ Cluster â”‚  â”‚Cluster â”‚  â”‚   Cluster    â”‚  â”‚ Cluster â”‚  â”‚   Cluster  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ºï¸ å®æ–½è·¯çº¿å›¾ / Implementation Roadmap

### Phase 1: ç´§æ€¥ä¿®å¤ä¸æ”¹è¿›ï¼ˆ1-2 å‘¨ï¼‰

#### 1.1 æ•°æ®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½
```typescript
// services/dataExportService.ts
export async function exportAllData(): Promise<Blob> {
  const videos = await getAllVideos();
  const exportData = {
    version: "1.0.0",
    exportDate: new Date().toISOString(),
    videos: videos.map(v => ({
      ...v,
      file: undefined  // ä¸å¯¼å‡ºæ–‡ä»¶ï¼Œä»…å¯¼å‡ºå…ƒæ•°æ®
    }))
  };
  
  const json = JSON.stringify(exportData, null, 2);
  return new Blob([json], { type: 'application/json' });
}

export async function importData(file: File): Promise<void> {
  const text = await file.text();
  const data = JSON.parse(text);
  
  // éªŒè¯æ•°æ®æ ¼å¼
  if (!validateImportData(data)) {
    throw new Error('Invalid data format');
  }
  
  // å¯¼å…¥æ•°æ®
  for (const video of data.videos) {
    await saveVideoAnalysis(video.id, video);
  }
}
```

#### 1.2 è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
```typescript
// services/autoBackupService.ts
export function setupAutoBackup() {
  // æ¯å¤©è‡ªåŠ¨å¤‡ä»½ä¸€æ¬¡
  setInterval(async () => {
    const backup = await exportAllData();
    const url = URL.createObjectURL(backup);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup_${new Date().toISOString()}.json`;
    a.click();
  }, 24 * 60 * 60 * 1000);  // 24 hours
}
```

#### 1.3 æ•°æ®éªŒè¯å±‚
```typescript
// services/dataValidationService.ts
export function validateVideoAnalysis(video: AnalyzedVideo): boolean {
  if (!video.id || !video.name) return false;
  if (!video.analysis?.frameAnalyses) return false;
  if (!Array.isArray(video.analysis.frameAnalyses)) return false;
  
  for (const frame of video.analysis.frameAnalyses) {
    if (typeof frame.timestamp !== 'number') return false;
    if (!frame.keywords?.en || !Array.isArray(frame.keywords.en)) return false;
  }
  
  return true;
}
```

---

### Phase 2: åç«¯ API å¼€å‘ï¼ˆ4-6 å‘¨ï¼‰

#### 2.1 æŠ€æœ¯æ ˆé€‰æ‹©
- **åç«¯æ¡†æ¶**: Node.js + Express / FastAPI (Python)
- **ORM**: Prisma (Node.js) / SQLAlchemy (Python)
- **è®¤è¯**: JWT + OAuth 2.0
- **API é£æ ¼**: REST + GraphQL

#### 2.2 æ ¸å¿ƒ API ç«¯ç‚¹
```typescript
// REST API è®¾è®¡
POST   /api/videos/upload          // ä¸Šä¼ è§†é¢‘
GET    /api/videos                 // è·å–è§†é¢‘åˆ—è¡¨
GET    /api/videos/:id             // è·å–å•ä¸ªè§†é¢‘
PUT    /api/videos/:id             // æ›´æ–°è§†é¢‘
DELETE /api/videos/:id             // åˆ é™¤è§†é¢‘
POST   /api/videos/:id/analyze     // è§¦å‘åˆ†æ
GET    /api/videos/:id/frames      // è·å–å¸§åˆ—è¡¨
GET    /api/search                 // æœç´¢è§†é¢‘
POST   /api/search/semantic        // è¯­ä¹‰æœç´¢
```

---

### Phase 3: æœç´¢å¼•æ“é›†æˆï¼ˆ2-4 å‘¨ï¼‰

#### 3.1 Meilisearch é›†æˆ
```typescript
// services/searchService.ts
import { MeiliSearch } from 'meilisearch';

const client = new MeiliSearch({
  host: 'http://localhost:7700',
  apiKey: 'masterKey'
});

export async function indexVideoFrame(frame: FrameAnalysis) {
  const index = client.index('video_frames');
  
  await index.addDocuments([{
    id: frame.id,
    video_id: frame.videoId,
    timestamp: frame.timestamp,
    keywords: [...frame.keywords.en, ...frame.keywords.cn],
    descriptions: [
      frame.personDescription.en,
      frame.actionDescription.en,
      frame.clothingDescription.en
    ].join(' ')
  }]);
}

export async function searchFrames(query: string) {
  const index = client.index('video_frames');
  return await index.search(query, {
    limit: 20,
    attributesToHighlight: ['descriptions'],
    attributesToCrop: ['descriptions']
  });
}
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ / Performance Optimization

### 1. **æ•°æ®åº“ä¼˜åŒ–**
- ä½¿ç”¨è¿æ¥æ± 
- åˆ›å»ºåˆé€‚çš„ç´¢å¼•
- å®šæœŸ VACUUM å’Œ ANALYZE
- åˆ†åŒºå¤§è¡¨

### 2. **ç¼“å­˜ç­–ç•¥**
- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- CDN ç¼“å­˜é™æ€èµ„æº
- Service Worker ç¼“å­˜å‰ç«¯èµ„æº

### 3. **è§†é¢‘å¤„ç†ä¼˜åŒ–**
- ä½¿ç”¨ FFmpeg å‹ç¼©è§†é¢‘
- ç”Ÿæˆå¤šç§åˆ†è¾¨ç‡çš„ç¼©ç•¥å›¾
- å¼‚æ­¥å¤„ç†è§†é¢‘åˆ†æä»»åŠ¡

### 4. **æœç´¢ä¼˜åŒ–**
- ä½¿ç”¨ Meilisearch çš„ typo tolerance
- é¢„è®¡ç®—å¸¸è§æŸ¥è¯¢ç»“æœ
- ä½¿ç”¨å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æœç´¢

---

## ğŸ”® æœªæ¥æ‰©å±•æ€§ / Future Scalability

### 1. **å¤šç§Ÿæˆ·æ”¯æŒ**
- æ•°æ®éš”ç¦»
- èµ„æºé…é¢ç®¡ç†
- ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹

### 2. **å®æ—¶åä½œ**
- WebSocket æ”¯æŒ
- å®æ—¶é€šçŸ¥
- å…±äº«å·¥ä½œç©ºé—´

### 3. **AI å¢å¼º**
- è‡ªåŠ¨æ ‡ç­¾ç”Ÿæˆ
- æ™ºèƒ½æ¨è
- å†…å®¹å®¡æ ¸

### 4. **åˆ†æä¸æŠ¥å‘Š**
- è§†é¢‘è§‚çœ‹åˆ†æ
- æœç´¢çƒ­è¯ç»Ÿè®¡
- ç”¨æˆ·è¡Œä¸ºåˆ†æ

---

## ğŸ“š æ¨èçš„å¼€æºç»„ä»¶

### æ•°æ®åº“
- **PostgreSQL**: https://www.postgresql.org/
- **Redis**: https://redis.io/

### æœç´¢å¼•æ“
- **Meilisearch**: https://www.meilisearch.com/
- **Typesense**: https://typesense.org/

### å‘é‡æ•°æ®åº“
- **Qdrant**: https://qdrant.tech/
- **Weaviate**: https://weaviate.io/

### å¯¹è±¡å­˜å‚¨
- **MinIO**: https://min.io/
- **AWS S3**: https://aws.amazon.com/s3/

### æ¶ˆæ¯é˜Ÿåˆ—
- **RabbitMQ**: https://www.rabbitmq.com/
- **Apache Kafka**: https://kafka.apache.org/

---

## ğŸ’¡ æ€»ç»“ä¸å»ºè®®

### çŸ­æœŸï¼ˆ1-3 ä¸ªæœˆï¼‰
1. âœ… å®ç°æ•°æ®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½
2. âœ… æ·»åŠ è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
3. âœ… åŠ å¼ºæ•°æ®éªŒè¯

### ä¸­æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰
1. ğŸ”¨ å¼€å‘åç«¯ API
2. ğŸ”¨ é›†æˆ PostgreSQL
3. ğŸ”¨ é›†æˆ Meilisearch

### é•¿æœŸï¼ˆ6-12 ä¸ªæœˆï¼‰
1. ğŸš€ å¾®æœåŠ¡æ¶æ„
2. ğŸš€ å‘é‡æœç´¢
3. ğŸš€ å¤šç§Ÿæˆ·æ”¯æŒ

---

**ä½œè€…**: AI Assistant  
**æ—¥æœŸ**: 2025-01-22  
**ç‰ˆæœ¬**: 1.0.0
